<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Puzzle Platformer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Courier New', Courier, monospace;
            color: white;
            flex-direction: column;
        }
        canvas {
            background-color: #333;
            border: 4px solid #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #instructions {
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div id="instructions">
        <h3>The Blue Cube Adventure</h3>
        <p>Move: Arrows/WASD | Jump: Space/Up</p>
        <p>Collect the <span style="color:gold">KEY</span> to open the <span style="color:hotpink">DOOR</span>. Avoid <span style="color:red">RED</span> blocks.</p>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- Game Configuration ---
    const gravity = 0.5;
    const friction = 0.8;
    const jumpStrength = -10;
    const speed = 5;

    // --- Game State ---
    let keys = {};
    let hasKey = false;
    let levelComplete = false;

    // --- Player Object ---
    const player = {
        x: 50,
        y: 450,
        width: 30,
        height: 30,
        dx: 0, // Velocity X
        dy: 0, // Velocity Y
        grounded: false,
        color: '#3498db' // Blue
    };

    // --- Level Elements ---
    // x, y, width, height, type
    const platforms = [
        // Borders
        {x: 0, y: 580, w: 800, h: 20, type: 'wall'},
        {x: 0, y: 0, w: 800, h: 20, type: 'wall'},
        {x: 0, y: 0, w: 20, h: 600, type: 'wall'},
        {x: 780, y: 0, w: 20, h: 600, type: 'wall'},
        
        // Platforms
        {x: 0, y: 500, w: 200, h: 20, type: 'wall'},
        {x: 250, y: 420, w: 150, h: 20, type: 'wall'},
        {x: 50, y: 300, w: 100, h: 20, type: 'wall'},
        {x: 250, y: 200, w: 20, h: 100, type: 'wall'}, // Vertical wall
        {x: 270, y: 200, w: 200, h: 20, type: 'wall'},
        
        // The Pit (Lava)
        {x: 200, y: 560, w: 580, h: 20, type: 'lava'},

        // High Platform
        {x: 600, y: 350, w: 100, h: 20, type: 'wall'},
        {x: 500, y: 150, w: 100, h: 20, type: 'wall'}
    ];

    // Objects
    const keyItem = { x: 540, y: 110, w: 20, h: 20, collected: false };
    const door = { x: 700, y: 520, w: 40, h: 60, open: false };

    // --- Input Handling ---
    document.addEventListener('keydown', (e) => keys[e.code] = true);
    document.addEventListener('keyup', (e) => keys[e.code] = false);

    // --- Collision Detection ---
    function checkCollision(rect1, rect2) {
        return (rect1.x < rect2.x + rect2.w &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.h &&
                rect1.y + rect1.height > rect2.y);
    }

    function resetGame() {
        player.x = 50;
        player.y = 450;
        player.dx = 0;
        player.dy = 0;
        hasKey = false;
        keyItem.collected = false;
        door.open = false;
        levelComplete = false;
    }

    function update() {
        if (levelComplete) return;

        // 1. Apply Physics (Horizontal)
        if (keys['ArrowRight'] || keys['KeyD']) player.dx = speed;
        else if (keys['ArrowLeft'] || keys['KeyA']) player.dx = -speed;
        else player.dx *= friction; // Friction slows us down

        player.x += player.dx;

        // Horizontal Collisions
        player.grounded = false;
        for (let p of platforms) {
            if (checkCollision(player, p)) {
                if (p.type === 'lava') { resetGame(); return; }
                
                // If moving right, hit left side of wall
                if (player.dx > 0) player.x = p.x - player.width;
                // If moving left, hit right side of wall
                else if (player.dx < 0) player.x = p.x + p.w;
                
                player.dx = 0;
            }
        }

        // 2. Apply Physics (Vertical)
        if ((keys['ArrowUp'] || keys['Space'] || keys['KeyW']) && player.grounded) {
            player.dy = jumpStrength;
            player.grounded = false;
        }

        player.dy += gravity;
        player.y += player.dy;

        // Vertical Collisions
        for (let p of platforms) {
            if (checkCollision(player, p)) {
                if (p.type === 'lava') { resetGame(); return; }

                // Hit floor
                if (player.dy > 0) {
                    player.y = p.y - player.height;
                    player.grounded = true;
                    player.dy = 0; // Stop falling
                } 
                // Hit ceiling
                else if (player.dy < 0) {
                    player.y = p.y + p.h;
                    player.dy = 0;
                }
            }
        }

        // 3. Logic: Key Collection
        if (!keyItem.collected && checkCollision(player, keyItem)) {
            keyItem.collected = true;
            hasKey = true;
            door.open = true; // Unlock door
        }

        // 4. Logic: Win Condition
        if (checkCollision(player, door)) {
            if (door.open) {
                levelComplete = true;
            }
        }
    }

    function draw() {
        // Clear screen
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Platforms
        for (let p of platforms) {
            ctx.fillStyle = p.type === 'lava' ? '#e74c3c' : '#7f8c8d';
            ctx.fillRect(p.x, p.y, p.w, p.h);
        }

        // Draw Door
        ctx.fillStyle = door.open ? '#2ecc71' : '#e91e63'; // Green if open, Pink if closed
        ctx.fillRect(door.x, door.y, door.w, door.h);
        // Door knob
        ctx.fillStyle = 'black';
        ctx.fillRect(door.x + 5, door.y + 30, 5, 5);

        // Draw Key (if not collected)
        if (!keyItem.collected) {
            ctx.fillStyle = 'gold';
            ctx.fillRect(keyItem.x, keyItem.y, keyItem.w, keyItem.h);
        }

        // Draw Player
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);
        
        // Draw Eyes (just for cuteness)
        ctx.fillStyle = 'white';
        ctx.fillRect(player.x + 5, player.y + 5, 8, 8);
        ctx.fillRect(player.x + 17, player.y + 5, 8, 8);

        // UI Text
        ctx.fillStyle = 'white';
        ctx.font = '20px Arial';
        if (hasKey) ctx.fillText("Key Collected! Go to the door!", 20, 50);
        else ctx.fillText("Find the key...", 20, 50);

        // Win Screen
        if (levelComplete) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '50px Arial';
            ctx.fillText("YOU WIN!", 280, 300);
            ctx.font = '20px Arial';
            ctx.fillText("Press F5 to restart", 310, 350);
        }
    }

    // --- Game Loop ---
    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    // Start the game
    loop();

</script>
</body>
</html>
