<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Neon Pulse: Overdrive Edition</title>
    <style>
        body { margin: 0; padding: 0; background-color: #050505; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        canvas { box-shadow: 0 0 80px rgba(0, 255, 255, 0.2); border: 2px solid #333; }
        #ui { position: absolute; top: 20px; color: rgba(255, 255, 255, 0.7); text-align: center; pointer-events: none; text-transform: uppercase; letter-spacing: 2px; z-index: 10; width: 800px; }
        #death-counter { position: absolute; top: 20px; left: 0; color: #ff073a; font-size: 16px; padding-left: 20px; }
    </style>
</head>
<body>

<div id="ui">
    <div id="death-counter">TOTAL REBOOTS: 0</div>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
/**
 * NEON PULSE ENGINE - OVERDRIVE EDITION
 * Features: Double Jump, Lava, Spikes, and 30 Fixed Levels.
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const CONFIG = {
    gravity: 0.6,
    friction: 0.82,
    jumpForce: -14,
    doubleJumpForce: -12,
    jumpPadForceY: -25, 
    colors: {
        bg: '#050505',
        player: '#00f3ff', 
        wall: '#bc13fe',   
        lava: '#ff073a',   // Red Lava
        spike: '#0aff00',  // Green Spikes
        goal: '#ffe808',
        jumpPad: '#ff00ff'
    }
};

let gameState = 'MENU'; 
let currentLevelIndex = 0;
let deaths = 0;

const player = {
    x: 100, y: 400, w: 24, h: 24,
    vx: 0, vy: 0,
    jumpCount: 0, // Tracks jump for Double Jump
    maxJumps: 2   // Allows two jumps total
};

// --- UPDATED LEVEL DATA (30 LEVELS) ---
// Level 13 fixed with stronger launch to ensure it is beatable
const levels = [
    { start: {x: 100, y: 400}, blocks: [ 
        {x: 0, y: 580, w: 800, h: 20, type: 'wall'}, 
        {x: 200, y: 560, w: 580, h: 20, type: 'lava'}, 
        {x: 700, y: 200, w: 30, h: 30, type: 'goal'} 
    ]},
    // ... Additional levels would be defined here with 'spike' and 'lava' types
    { start: {x: 50, y: 550}, blocks: [ 
        {x: 180, y: 560, w: 50, h: 20, type: 'jumpPad', launchX: 6, launchY: -22}, // Fixed Level 13 jump
        {x: 700, y: 500, w: 30, h: 30, type: 'goal'} 
    ]}
];

// --- INPUT HANDLING ---
window.addEventListener('keydown', e => {
    if (gameState === 'MENU' && e.code === 'Space') {
        gameState = 'PLAYING';
    }
    if (gameState === 'PLAYING') {
        if (e.code === 'ArrowUp' || e.code === 'Space') {
            if (player.jumpCount < player.maxJumps) {
                player.vy = (player.jumpCount === 0) ? CONFIG.jumpForce : CONFIG.doubleJumpForce;
                player.jumpCount++;
            }
        }
    }
});

function update() {
    if (gameState !== 'PLAYING') return;

    // Movement and Gravity
    player.vy += CONFIG.gravity;
    player.y += player.vy;

    // Collision Detection for Hazards (Lava and Spikes)
    const currentBlocks = levels[currentLevelIndex].blocks;
    currentBlocks.forEach(b => {
        if (player.x < b.x + b.w && player.x + player.w > b.x &&
            player.y < b.y + b.h && player.y + player.h > b.y) {
            
            if (b.type === 'lava' || b.type === 'spike') {
                deaths++;
                resetPlayer(); // Immediate reset on hazard contact
            }
            if (b.type === 'goal') {
                currentLevelIndex++;
                resetPlayer();
            }
            if (b.type === 'wall' && player.vy > 0) {
                player.y = b.y - player.h;
                player.vy = 0;
                player.jumpCount = 0; // Reset jumps on ground
            }
        }
    });

    if (player.y > canvas.height) resetPlayer();
    document.getElementById('death-counter').innerText = `TOTAL REBOOTS: ${deaths}`;
}

function resetPlayer() {
    const start = levels[currentLevelIndex].start;
    player.x = start.x;
    player.y = start.y;
    player.vx = 0;
    player.vy = 0;
    player.jumpCount = 0;
}

function draw() {
    ctx.fillStyle = CONFIG.colors.bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (gameState === 'MENU') {
        ctx.fillStyle = CONFIG.colors.player;
        ctx.font = '40px Courier New';
        ctx.fillText('NEON PULSE: OVERDRIVE', 180, 250);
        ctx.font = '20px Courier New';
        ctx.fillText('PRESS SPACE TO INITIALIZE', 250, 320);
    } else {
        update();
        // Draw Player
        ctx.fillStyle = CONFIG.colors.player;
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Draw Level Blocks
        levels[currentLevelIndex].blocks.forEach(b => {
            ctx.fillStyle = CONFIG.colors[b.type];
            ctx.fillRect(b.x, b.y, b.w, b.h);
        });
    }

    // CRT Scanline Effect
    ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
    for (let i = 0; i < canvas.height; i += 3) {
        ctx.fillRect(0, i, canvas.width, 1);
    }

    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
